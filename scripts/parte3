import pandas as pd
import matplotlib.pyplot as plt
import numpy as np
from pathlib import Path
import pingouin as pg
from lets_plot import *

LetsPlot.setup_html(no_js=True)

#data NASA
url = "https://raw.githubusercontent.com/nataliarodriguezfr/Taller-3/9f4d8aea5f1dc38cdab50e644f0316559f34d1a9/data/raw_data/tablas_temperatura.csv"

df = pd.read_csv(url, skiprows=1, na_values="***")  # Ajusta skiprows según el contenido

df = df.set_index("Year") #Pone los años como indices 

#data carbon emmisions
urlco = "https://raw.githubusercontent.com/nataliarodriguezfr/Taller-3/809e9a05b666713ee63644f4cf6e50876938f7c3/data/raw_data/doing-economics-datafile-working-in-excel-project-1.csv"

df_co2 = pd.read_csv(urlco)

# Verifica las primeras filas
print(df_co2.head())

#scatterplot temperatura anomalies vs carbon amissions

df_co2_june = df_co2.loc[df_co2["Month"] == 6]
df_co2_june.head()

df_temp_co2 = pd.merge(df_co2_june, df, on="Year")
df_temp_co2[["Year", "Jun", "Trend"]].head()

(
    ggplot(df_temp_co2, aes(x="Jun", y="Trend"))
    + geom_point(color="black", size=3)
    + labs(
        title="Scatterplot of temperature anomalies vs carbon dioxide emissions",
        y="Carbon dioxide levels (trend, mole fraction)",
        x="Temperature anomaly (degrees Celsius)",
    )
)


#correlation coefficient

df_temp_co2[["Jun", "Trend"]].corr(method="pearson")

#june temperature anomalies

(
    ggplot(df_temp_co2, aes(x="Year", y="Jun"))
    + geom_line(size=1)
    + labs(
        title="June temperature anomalies",
    )
    + scale_x_continuous(format="d")
)

#second panel: june temperature anomalies and carbon emissions

base_plot = ggplot(df_temp_co2) + scale_x_continuous(format="d")
plot_p = (
    base_plot
    + geom_line(aes(x="Year", y="Jun"), size=1)
    + labs(title="June temperature anomalies")
)
plot_q = (
    base_plot
    + geom_line(aes(x="Year", y="Trend"), size=1)
    + labs(title="Carbon dioxide emissions")
)
gggrid([plot_p, plot_q], ncol=2)

#third panel: october temperature anomalies and carbon emissions

base_plot_2 = ggplot(df_temp_co2) + scale_x_continuous(format="d")
plot_p = (
    base_plot_2
    + geom_line(aes(x="Year", y="Oct"), size=1)
    + labs(title="October temperature anomalies")
)
plot_q = (
    base_plot_2
    + geom_line(aes(x="Year", y="Trend"), size=1)
    + labs(title="Carbon dioxide emissions")
)
gggrid([plot_p, plot_q], ncol=2)


